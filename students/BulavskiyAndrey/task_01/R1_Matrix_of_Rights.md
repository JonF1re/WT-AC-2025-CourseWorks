# Вариант 33 — Матрица прав (операция × роль) — Органайзер «Без лишних чатов»

Операции: просмотр/создание/редактирование/удаление объявлений, файлов, событий календаря, опросов, сообщений в чатах, а также управление участниками и настройками группы.  
Роли: **Администратор**, **Модератор**, **Участник**, **Гость**.

---

## 1. Таблица прав (MVP)

| Операция                                         | Администратор | Модератор | Участник | Гость |
|--------------------------------------------------|:-------------:|:---------:|:--------:|:-----:|
| Просмотр объявлений (`Announcement`)             | ✓             | ✓         | ✓        | (✓)\* |
| Создание объявления                              | ✓             | ✓         | ✗        | ✗     |
| Редактирование/удаление своих объявлений         | ✓             | ✓         | ✗        | ✗     |
| Редактирование/удаление любых объявлений         | ✓             | (✓)\*\*   | ✗        | ✗     |
| Закрепление объявления                           | ✓             | ✓         | ✗        | ✗     |
|                                                  |               |           |          |       |
| Просмотр файлов (`File`)                         | ✓             | ✓         | ✓        | (✓)\* |
| Загрузка файлов                                  | ✓             | ✓         | (✓)\*\*\*| ✗     |
| Удаление/переименование своих файлов             | ✓             | ✓         | (✓)\*\*\*| ✗     |
| Удаление/переименование любых файлов             | ✓             | (✓)\*\*   | ✗        | ✗     |
|                                                  |               |           |          |       |
| Просмотр календаря (`Event`)                     | ✓             | ✓         | ✓        | (✓)\* |
| Создание/редактирование событий                  | ✓             | ✓         | ✗        | ✗     |
| Удаление событий                                 | ✓             | ✓         | ✗        | ✗     |
|                                                  |               |           |          |       |
| Просмотр опросов (`Poll`)                        | ✓             | ✓         | ✓        | ✗     |
| Создание опроса                                  | ✓             | ✓         | ✗        | ✗     |
| Голосование (`Vote`)                             | ✓             | ✓         | ✓        | ✗     |
| Просмотр результатов опросов                     | ✓             | ✓         | (✓)\*\*\*\* | ✗  |
|                                                  |               |           |          |       |
| Просмотр сообщений в чатах (`Message`)           | ✓             | ✓         | ✓        | ✗     |
| Отправка сообщений в общий чат                   | ✓             | ✓         | ✓        | ✗     |
| Отправка сообщений в служебные/ограниченные чаты | ✓             | ✓         | (огр.)   | ✗     |
| Редактирование/удаление своих сообщений          | ✓             | ✓         | ✓        | ✗     |
| Удаление чужих сообщений (модерация)             | ✓             | ✓         | ✗        | ✗     |
|                                                  |               |           |          |       |
| Управление участниками (`User` в рамках группы)  | ✓             | ✗         | ✗        | ✗     |
| Назначение/изменение ролей                       | ✓             | ✗         | ✗        | ✗     |
| Блокировка/разблокировка участников              | ✓             | ✗         | ✗        | ✗     |
|                                                  |               |           |          |       |
| Настройки группы и модулей (вкл/выкл)            | ✓             | ✗         | ✗        | ✗     |
| Настройка дайджеста                              | ✓             | ✗         | ✗        | ✗     |

---

## 2. Примечания и ограничения

- \* **Гость**:
  - Может видеть только те объявления, файлы и события, которые администратор пометил как публичные.
  - По умолчанию гость **не имеет доступа** к контенту группы (поведение по умолчанию — закрытая группа).

- \*\* **Модератор и чужой контент**:
  - Способности модератора редактировать/удалять чужие объявления и файлы зависят от политики группы.
  - В минимальном MVP можно считать, что модератор может модерировать контент, но не может менять системные настройки или роли.

- \*\*\* **Участник и загрузка файлов**:
  - Участник может загружать файлы только в разрешённые пространства (например, «Загрузить домашнее задание»).
  - По умолчанию участник не может загружать файлы в общую «официальную» библиотеку материалов.

- \*\*\*\* **Просмотр результатов опросов участниками**:
  - По умолчанию участник видит результаты в агрегированном виде.
  - Администратор может настроить опрос как «закрытый» (результаты только для админа/модераторов).

Дополнительные ограничения:

- Участник видит только свою группу и чаты/каналы, к которым он добавлен.
- Участник не может:
  - менять роли,
  - удалять других участников,
  - изменять настройки группы.
- Гость не может:
  - писать в чаты,
  - голосовать в опросах,
  - создавать какие‑либо сущности.

---

## 3. Связь с моделью данных и API

На уровне API матрица прав реализуется через:

- Аутентификацию (например, JWT) с хранением роли в токене.
- Middleware/guard, проверяющие:
  - роль (`admin`, `moderator`, `member`, `guest`);
  - принадлежность к группе/чату (`group_id`, `chat_id`);
  - владение ресурсом (создатель объявления/файла/сообщения).
- Ограничение доступа к ресурсам:
  - `GET /announcements` — фильтрация по группе и видимости;
  - `POST /announcements` — только `admin` и `moderator`;
  - `POST /polls/{id}/votes` — только участники группы и только один голос на пользователя;
  - `POST /chats/{id}/messages` — только если пользователь состоит в чате и имеет право писать.

Эти правила должны быть согласованы с файлами:

- `R1_Roles_and_Actions.md` — словесное описание ролей и операций.
- `R1_DataModel_and_API.md` — ресурсы и эндпоинты.
- `R1_Routes.md` — пользовательские сценарии.
