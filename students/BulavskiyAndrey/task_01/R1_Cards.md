# Вариант 33 — Органайзер «Без лишних чатов» — Карточки (обязательные поля и валидации)

Тема: Органайзер учебной/рабочей группы с объявлениями, файлами, календарём, опросами и чатами.  
Цель: убрать «информационный шум» из чатов и собрать всё важное в структурированном виде.

---

## 1. Карточка пользователя (User)

- `id: UUID` — автогенерируется.
- `name: string` — отображаемое имя, не пустое, 2–100 символов  
  → ошибка: «Имя должно быть от 2 до 100 символов.»
- `email: string` — уникальное, формат email  
  → ошибка: «Введите корректный email.» / «Email уже используется.»
- `password_hash: string` — хэш пароля (пароль не хранится в открытом виде).
- `created_at: datetime` — автозаполнение.

> Примечание: роль (`admin`, `moderator`, `member`, `guest`) задаётся через членство в группе (`Membership`), а не внутри `User`.

---

## 2. Карточка группы (Group)

- `id: UUID` — автогенерируется.
- `name: string` — название группы, не пустое, максимум 200 символов  
  → ошибка: «Введите название группы (до 200 символов).»
- `description: string` — опционально, максимум 2000 символов.
- `is_private: boolean` — по умолчанию `true` (закрытая группа).
- `created_by: reference -> User.id` — владелец/создатель группы.
- `created_at: datetime` — автозаполнение.

Ограничения:

- Пользователь без членства в группе не должен видеть её содержимое (если `is_private = true`).

---

## 3. Карточка членства в группе (Membership)

- `id: UUID` — автогенерируется.
- `user_id: reference -> User.id` — не пустое  
  → ошибка: «Укажите пользователя.»
- `group_id: reference -> Group.id` — не пустое  
  → ошибка: «Укажите группу.»
- `role: enum [admin, moderator, member, guest]` — не пустое  
  → ошибка: «Укажите роль участника группы.»
- `joined_at: datetime` — дата вступления, автозаполнение.
- `is_active: boolean` — по умолчанию `true`.

Ограничения:

- `unique (user_id, group_id)` — один пользователь не может иметь дублирующиеся записи членства.

---

## 4. Карточка объявления (Announcement)

- `id: UUID` — автогенерируется.
- `group_id: reference -> Group.id` — не пустое  
  → ошибка: «Не указана группа для объявления.»
- `author_id: reference -> User.id` — не пустое  
  → ошибка: «Не указан автор объявления.»
- `title: string` — не пустое, максимум 200 символов  
  → ошибка: «Введите заголовок объявления (до 200 символов).»
- `content: string` — не пустое, максимум 5000 символов  
  → ошибка: «Введите текст объявления (до 5000 символов).»
- `is_pinned: boolean` — по умолчанию `false`.
- `is_public: boolean` — по умолчанию `false` (видно только участникам группы).
- `published_at: datetime` — дата публикации (заполняется при публикации).
- `created_at: datetime` — автозаполнение.
- `updated_at: datetime` — автозаполнение при изменении.

Ограничения:

- Редактирование/удаление объявления:
  - автор + админ/модератор (по матрице прав).

---

## 5. Карточка файла (File)

- `id: UUID` — автогенерируется.
- `group_id: reference -> Group.id` — не пустое  
  → ошибка: «Не указана группа для файла.»
- `uploader_id: reference -> User.id` — не пустое  
  → ошибка: «Не указан загрузивший файл пользователь.»
- `name: string` — отображаемое имя файла, не пустое, максимум 255 символов  
  → ошибка: «Введите название файла (до 255 символов).»
- `description: string` — опционально, максимум 2000 символов.
- `file_path: string` — внутренний путь/ключ в хранилище, задаётся сервером.
- `file_size: integer` — > 0, не более, например, 100 МБ  
  → ошибка: «Размер файла должен быть больше 0 и не более 100 МБ.»
- `mime_type: string` — допустимые типы: `pdf`, `doc`, `docx`, `ppt`, `pptx`, `xls`, `xlsx`, `jpg`, `png`, `mp4` (можно ограничить)  
  → ошибка: «Недопустимый тип файла.»
- `category: string` — опционально (лекции, задания и т. д.).
- `created_at: datetime` — автозаполнение.

Ограничения:

- Имя файла не должно содержать запрещённые символы и path traversal (`../`).
- Доступ к файлу есть только у участников группы (и у гостей — только к публичным материалам, если включено).

---

## 6. Карточка события календаря (Event)

- `id: UUID` — автогенерируется.
- `group_id: reference -> Group.id` — не пустое  
  → ошибка: «Не указана группа для события.»
- `creator_id: reference -> User.id` — не пустое  
  → ошибка: «Не указан создатель события.»
- `title: string` — не пустое, максимум 200 символов  
  → ошибка: «Введите название события (до 200 символов).»
- `description: string` — опционально, максимум 2000 символов.
- `start_at: datetime` — не пустое  
  → ошибка: «Укажите дату и время начала события.»
- `end_at: datetime` — опционально, но если заполнено — `end_at >= start_at`  
  → ошибка: «Время окончания не может быть раньше начала.»
- `type: enum [lecture, deadline, exam, meeting, other]` — не пустое  
  → ошибка: «Укажите тип события.»
- `location: string` — опционально (аудитория, ссылка).
- `created_at: datetime` — автозаполнение.

Ограничения:

- Событие должно принадлежать группе; участник другой группы не должен его видеть.

---

## 7. Карточка опроса (Poll) и вариантов (Choice)

### 7.1. Poll

- `id: UUID` — автогенерируется.
- `group_id: reference -> Group.id` — не пустое  
  → ошибка: «Не указана группа для опроса.»
- `creator_id: reference -> User.id` — не пустое  
  → ошибка: «Не указан создатель опроса.»
- `question: string` — не пустое, максимум 500 символов  
  → ошибка: «Введите вопрос опроса (до 500 символов).»
- `is_anonymous: boolean` — по умолчанию `true`.
- `is_multiple_choice: boolean` — по умолчанию `false`.
- `expires_at: datetime` — опционально; если указано, то должно быть в будущем на момент создания  
  → ошибка: «Время окончания опроса должно быть в будущем.»
- `created_at: datetime` — автозаполнение.

### 7.2. Choice

- `id: UUID` — автогенерируется.
- `poll_id: reference -> Poll.id` — не пустое  
  → ошибка: «Не указан опрос для варианта ответа.»
- `text: string` — не пустое, максимум 200 символов  
  → ошибка: «Введите текст варианта ответа (до 200 символов).»
- `order: integer` — порядок отображения, неотрицательное целое.

---

## 8. Карточка голоса (Vote)

- `id: UUID` — автогенерируется.
- `poll_id: reference -> Poll.id` — не пустое  
  → ошибка: «Не указан опрос.»
- `choice_id: reference -> Choice.id` — не пустое  
  → ошибка: «Не указан выбранный вариант.»
- `voter_id: reference -> User.id` — не пустое  
  → ошибка: «Не указан голосующий пользователь.»
- `created_at: datetime` — автозаполнение.

Ограничения:

- Один пользователь может проголосовать не более одного раза в опросе (для одиночного выбора)  
  → ошибка: «Вы уже голосовали в этом опросе.»
- При множественном выборе — не более N вариантов (если задано в настройках опроса).
- Нельзя голосовать после `expires_at`  
  → ошибка: «Опрос уже завершён.»

---

## 9. Карточка чата (Chat) и сообщения (Message)

### 9.1. Chat

- `id: UUID` — автогенерируется.
- `group_id: reference -> Group.id` — не пустое  
  → ошибка: «Не указана группа для чата.»
- `title: string` — не пустое, максимум 200 символов  
  → ошибка: «Введите название чата (до 200 символов).»
- `type: enum [group, private, topic]` — не пустое  
  → ошибка: «Укажите тип чата.»
- `is_read_only: boolean` — по умолчанию `false`.
- `created_by: reference -> User.id` — не пустое.
- `created_at: datetime` — автозаполнение.

### 9.2. Message

- `id: UUID` — автогенерируется.
- `chat_id: reference -> Chat.id` — не пустое  
  → ошибка: «Не указан чат для сообщения.»
- `author_id: reference -> User.id` — не пустое  
  → ошибка: «Не указан автор сообщения.»
- `content: string` — не пустое, максимум 4000 символов  
  → ошибка: «Введите текст сообщения (до 4000 символов).»
- `attachments: JSON` — список прикреплённых файлов (идентификаторы `File`), может быть пустым.
- `created_at: datetime` — автозаполнение.
- `edited_at: datetime` — заполняется при редактировании.
- `is_deleted: boolean` — по умолчанию `false`.

Ограничения:

- В read‑only чат пользователь с ролью `member` не может отправлять сообщения  
  → ошибка: «В этом чате запрещено отправлять сообщения.»
- Автор может редактировать/удалить своё сообщение только в пределах допустимого окна времени (например, 15 минут).

---

## 10. Пользовательские истории (User Stories)

Ниже — примерный набор историй для MVP, отражающих основные сценарии работы с органайзером.

### US‑01: Просмотр объявлений без поиска в чатах

**Как** участник группы  
**Я хочу** видеть ленту объявлений в одном месте  
**Чтобы** быстро находить важную информацию без прокрутки чатов

**Критерии приёмки (AC):**

- На странице объявлений отображаются только объявления моей группы.
- Объявления отсортированы по дате публикации (последние выше).
- Я могу открыть объявление и увидеть полный текст и связанные файлы/события.

---

### US‑02: Создание объявления администратором

**Как** администратор группы  
**Я хочу** публиковать объявления для всех участников  
**Чтобы** доносить важную информацию в структурированном виде

**AC:**

- Я могу создать объявление, заполнив заголовок и текст.
- Без заголовка или текста объявление сохранить нельзя.
- После публикации объявление появляется в ленте всех участников группы.
- Я могу отредактировать или удалить своё объявление.

---

### US‑03: Общая библиотека файлов

**Как** участник группы  
**Я хочу** иметь доступ к библиотеке файлов  
**Чтобы** быстро находить лекции, задания и другие материалы

**AC:**

- Я вижу список файлов для моей группы с названием, автором и датой загрузки.
- Я могу отфильтровать файлы по категории (лекции, задания и т. д.).
- Я могу скачать файл, если у меня есть доступ к группе.

---

### US‑04: Календарь с дедлайнами

**Как** участник группы  
**Я хочу** видеть календарь с важными событиями и дедлайнами  
**Чтобы** не пропускать лекции, экзамены и сроки сдачи работ

**AC:**

- В календаре отображаются события только моей группы.
- Я могу переключаться между видами «список» и «месяц/неделя».
- При клике на событие я вижу детали (описание, время, место).

---

### US‑05: Опрос по времени встречи

**Как** модератор  
**Я хочу** создать опрос с вариантами времени встречи  
**Чтобы** выбрать удобное время для всей группы

**AC:**

- Я могу задать вопрос и добавить несколько вариантов ответа.
- Участник может проголосовать только один раз (или выбрать несколько вариантов — если разрешено).
- После окончания голосования результаты доступны модератору и участникам (если не скрыты настройками).

---

### US‑06: Общий чат группы

**Как** участник группы  
**Я хочу** общаться в общем чате  
**Чтобы** обсуждать организационные вопросы и обмениваться ссылками

**AC:**

- Я вижу список сообщений в общем чате, отсортированных по времени.
- Я могу отправлять сообщения и прикреплять файлы.
- Я могу редактировать/удалить своё сообщение в течение ограниченного времени.

---

### US‑07: Модерация сообщений

**Как** модератор  
**Я хочу** иметь возможность удалять некорректные сообщения  
**Чтобы** поддерживать порядок в чатах группы

**AC:**

- Я вижу все сообщения в чатах моей группы.
- Я могу скрыть/пометить сообщение как удалённое (без полного удаления из базы).
- Обычный участник не может удалять сообщения других участников.

---

### US‑08: Дайджест активности (бонус)

**Как** участник группы  
**Я хочу** получать дайджест новых объявлений, событий и опросов  
**Чтобы** быть в курсе, даже если не заходил в систему каждый день

**AC:**

- Формируется сводка за выбранный период (например, неделя).
- В дайджест попадают новые объявления, ближайшие события и активные опросы.
- Я могу открыть ссылку из дайджеста и перейти к соответствующему объекту в системе.
